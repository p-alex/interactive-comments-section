(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{P:()=>q,J:()=>I});const t=()=>null===JSON.parse(window.localStorage.getItem("data"))?null:JSON.parse(window.localStorage.getItem("data")),n=e=>{window.localStorage.setItem("data",JSON.stringify(e))},o=({scoreType:e,commentId:o,isReply:r})=>{const c=t(),{comments:s,currentUser:a}=c,l=a.scored.find((e=>e.id===o));if(l&&"downvote"===l.scoreType&&"upvote"===e){if(a.scored.forEach((t=>{t.id===o&&t.scoreType!==e&&(t.scoreType=e)})),r){const e=s.map((e=>(e.replies.forEach((t=>{if(e.user.username===a.username)return t;t.id!==o||(t.score+=2)})),e)));return void n({comments:e,currentUser:a})}const t=s.map((e=>e.user.username===a.username?e:e.id===o?(e.score+=2,e):e));n({comments:t,currentUser:a})}else if(l&&"upvote"===l.scoreType&&"upvote"===e){if(a.scored=a.scored.filter((e=>e.id!==o)),r){const e=s.map((e=>(e.replies.forEach((e=>{e.id!==o||e.score--})),e)));return void n({comments:e,currentUser:a})}const e=s.map((e=>e.id===o?(e.score--,e):e));n({comments:e,currentUser:a})}else if(l&&"upvote"===l.scoreType&&"downvote"===e){if(a.scored.forEach((t=>{t.id===o&&(t.scoreType=e)})),r){const e=s.map((e=>(e.replies.forEach((e=>{e.id!==o||(e.score-=2)})),e)));return void n({comments:e,currentUser:a})}const t=s.map((e=>e.id===o?(e.score-=2,e):e));n({comments:t,currentUser:a})}else if(l&&"downvote"===l.scoreType&&"downvote"===e){if(a.scored=a.scored.filter((e=>e.id!==o)),r){const e=s.map((e=>(e.replies.forEach((e=>{e.id!==o||e.score++})),e)));return void n({comments:e,currentUser:a})}const e=s.map((e=>e.id===o?(e.score++,e):e));n({comments:e,currentUser:a})}else if(l||"upvote"!==e)if(l||"downvote"!==e);else{if(a.scored.push({id:o,scoreType:e}),r){const e=s.map((e=>(e.replies.forEach((e=>{e.id===o&&e.score--})),e)));return void n({comments:e,currentUser:a})}const t=s.map((e=>e.id===o?(e.score--,e):e));n({comments:t,currentUser:a})}else{if(a.scored.push({id:o,scoreType:e}),r){const e=s.map((e=>(e.replies.forEach((e=>{e.id===o&&e.score++})),e)));return void n({comments:e,currentUser:a})}const t=s.map((e=>e.id===o?(e.score++,e):e));n({comments:t,currentUser:a})}},r=({elementToChange:e,commentId:n,scoreType:o,commentType:r,upvoteBtn:c,downvoteBtn:s})=>{const a=t(),{comments:l,currentUser:i}=a;let d=0;"normal"===r&&l.forEach((e=>{e.id===n&&(d=e.score)})),"reply"===r&&l.forEach((e=>{e.replies.forEach((e=>{e.id===n&&(d=e.score)}))}));const m=i.scored.find((e=>e.id===n));return m&&"downvote"===m.scoreType&&"upvote"===o?(c.classList.add("btn-active"),s.classList.remove("btn-active"),void(e.textContent=`${d+2}`)):m&&"upvote"===m.scoreType&&"upvote"===o?(c.classList.remove("btn-active"),s.classList.remove("btn-active"),void(e.textContent=""+(d-1))):m&&"upvote"===m.scoreType&&"downvote"===o?(c.classList.remove("btn-active"),s.classList.add("btn-active"),void(e.textContent=""+(d-2))):m&&"downvote"===m.scoreType&&"downvote"===o?(c.classList.remove("btn-active"),s.classList.remove("btn-active"),void(e.textContent=`${d+1}`)):m||"upvote"!==o?m||"downvote"!==o?void 0:(c.classList.remove("btn-active"),s.classList.add("btn-active"),void(e.textContent=""+(d-1))):(c.classList.add("btn-active"),s.classList.remove("btn-active"),void(e.textContent=`${d+1}`))};let c;const s=()=>{if(!document.querySelector(".confirmModal")){const e=(()=>{const e=document.createElement("div");e.classList.add("confirmModal"),e.setAttribute("aria-modal","true"),e.innerHTML='\n    <div class="confirmModal__backdrop"></div>\n        <div class="confirmModal__body">\n        <h2 class="confirmModal__title">Delete comment</h2>\n        <p class="confirmModal__text">\n            Are you sure you want to delete this comment? This will remove the\n            comment and can\'t be undone.\n        </p>\n        <div class="confirmModal__btns">\n            <div tabindex="0" class="confirmModal__topFocusTrap"></div>\n            <button class="confirmModal__btn">No, cancel</button>\n            <button class="confirmModal__btn confirmModal__btn-delete">\n            Yes, delete\n            </button>\n            <div tabindex="0" class="confirmModal__bottomFocusTrap"></div>\n        </div>\n        </div>\n';const t=e.querySelector(".confirmModal__btn"),n=e.querySelector(".confirmModal__btn-delete");return t.addEventListener("click",i),n.addEventListener("click",l),e.querySelector(".confirmModal__backdrop").addEventListener("click",i),e})();document.body.prepend(e);const t=e.querySelector(".confirmModal__btn");t.focus(),d({modal:e,firstFocusableElement:t})}},a=e=>{c=e},l=()=>{c.elementToDelete.remove(),(({parentId:e,isReply:o,replyId:r})=>{const c=t();if(o){const t=c.comments.map((t=>{if(t.id===e){const e=t.replies.filter((e=>e.id!==r));return t.replies=e,t}return t}));return n({comments:t,currentUser:c.currentUser}),void console.log("Deleted reply from local storage!")}const s=c.comments.filter((t=>t.id!==e));n({comments:s,currentUser:c.currentUser}),console.log("Deleted comment from local storage!")})({parentId:c.parentId,isReply:c.isReply,replyId:c.replyId}),i()},i=()=>{c.elementToDelete.querySelector(".commentBox__btn").focus(),document.querySelector(".confirmModal").remove()},d=({modal:e,firstFocusableElement:t})=>{const n=e.querySelector(".confirmModal__topFocusTrap"),o=e.querySelector(".confirmModal__bottomFocusTrap"),r=e.querySelector(".confirmModal__btn-delete");n.addEventListener("focus",(()=>r.focus())),o.addEventListener("focus",(()=>t.focus()))},m=e=>{var t,n;s();const o=e.target,r=o.parentElement.parentElement.parentElement.parentElement.parentElement.closest(".commentBox__container"),c=r.classList.contains("reply-comment");if(c){const e=null===(n=null===(t=r.parentElement)||void 0===t?void 0:t.parentElement)||void 0===n?void 0:n.parentElement;a({elementToDelete:r,parentId:e.getAttribute("id"),isReply:c,replyId:r.getAttribute("id"),returnFocusToElement:o.parentElement})}else a({elementToDelete:r,parentId:r.getAttribute("id"),isReply:c,replyId:"",returnFocusToElement:o.parentElement})},u=({parentId:e,isReply:o,replyId:r,content:c})=>{const s=t();if(o){const t=s.comments.map((t=>{if(t.id===e){const e=t.replies.map((e=>e.id===r?(e.content=c,e):e));return t.replies=e,t}return t}));return n({comments:t,currentUser:s.currentUser}),void console.log("Edited reply successfuly")}const a=s.comments.map((t=>t.id===e?(t.content=c,t):t));n({comments:a,currentUser:s.currentUser}),console.log("Edited comment successfuly")};let p=null;const v=e=>{const t=e.target.parentElement.parentElement.parentElement.parentElement.parentElement.closest(".commentBox__container");p=t;const n=t.querySelector(".commentBox__text");n.querySelector("#comment-text").style.display="none";const o=f(t,n);n.appendChild(o);o.querySelector(".commentBox__textarea").focus()},y=(e,t)=>{const n=null==p?void 0:p.querySelector("#edit-btn");e.remove(),t.style.removeProperty("display"),n.focus()},f=(e,t)=>{const n=t.querySelector("#comment-text"),o=document.createElement("div");if(!e.querySelector(".commentBox__textarea")){const e=document.createElement("textarea");e.classList.add("commentBox__textarea"),e.placeholder="Edit your comment...",e.value=n.textContent,o.appendChild(e)}const r=o.querySelector(".commentBox__textarea");if(!e.querySelector(".commentBox__editModeBtnsContainer")){const c=document.createElement("div");c.classList.add("commentBox__editModeBtnsContainer");const s=L({text:"Update",withIcon:!1,btnStyle:"fill"});s.classList.add("update-btn");const a=L({text:"Cancel",withIcon:!1,btnStyle:"normal"});a.classList.add("cancel-btn"),a.classList.add("cancel-btn"),c.appendChild(s),c.appendChild(a),o.appendChild(c),s.addEventListener("click",(()=>{((e,t,n)=>{var o,r;t.textContent=n;const c=e.classList.contains("reply-comment");if(c){const t=null===(r=null===(o=e.parentElement)||void 0===o?void 0:o.parentElement)||void 0===r?void 0:r.parentElement;u({parentId:t.getAttribute("id"),isReply:c,replyId:e.getAttribute("id"),content:n})}else u({parentId:e.getAttribute("id"),isReply:c,replyId:"",content:n})})(e,n,r.value),y(o,n)})),a.addEventListener("click",(()=>y(o,n))),o.appendChild(c),t.appendChild(o)}const c=document.createElement("div");c.classList.add("commentBox__topFocusTrap"),c.tabIndex=0;const s=document.createElement("div");s.classList.add("commentBox__bottomFocusTrap"),s.tabIndex=0;const a=r,l=o.querySelector(".cancel-btn");return o.prepend(c),o.appendChild(s),_(c,s,a,l),o},_=(e,t,n,o)=>{e.addEventListener("focus",(()=>o.focus())),t.addEventListener("focus",(()=>n.focus()))},b=({commentData:e,isReply:o,index:r})=>{const c=t();if(o){const t=e,o=c.comments.map((e=>e.id===r?(e.replies.push(t),e):e));return n({comments:o,currentUser:c.currentUser}),void console.log("Added reply to local storage!")}const s=e;n({comments:[...c.comments,s],currentUser:c.currentUser}),console.log("Added comment to local storage!")},h=()=>{const e="aA1bB2cC3dD4eE5fF6gG7hH8iI9jJ1kK2lL3mM4nN5oO6pP7qQ8rR9sS1tT2uU3vV4wW5xX6yY7zZ8";let t="";for(let n=0;n<=20;n++)t+=e[Math.floor(Math.random()*e.length)];return t},x=t(),g=({textareaPlaceholder:e,btnText:t,submitFunc:n,cancelFunc:o,withCancel:r})=>{const c=document.createElement("div");if(c.classList.add("form"),c.innerHTML=`\n      <img src="./images/avatars/image-juliusomo.png" alt="" width="45" height="45" />\n      <div class="form__topFocusTrap"></div>\n      <textarea class="form__text" aria-label="${e}" placeholder="${e}" id="form-content"></textarea>\n      <div class="form__btnsContainer">\n        <button class="form__submitBtn">${t}</button>\n      </div>\n      <div class="form__bottomFocusTrap"></div>\n    `,r){const e=c.querySelector(".form__btnsContainer"),t=L({text:"Cancel",withIcon:!1,btnStyle:"normal"});t.addEventListener("click",(()=>o({formToRemove:c}))),e.appendChild(t);c.querySelector(".form__topFocusTrap").tabIndex=0;c.querySelector(".form__bottomFocusTrap").tabIndex=0}return c.querySelector(".form__submitBtn").addEventListener("click",n),c},E=({appendFormTo:e,formToAppend:t})=>{e.appendChild(t),S(t)},T=()=>{const e=I.querySelector("#form-content");if(e.value.trim()){const t=h(),n=C({id:t,score:0,userImage:x.currentUser.image.png,username:x.currentUser.username,createdAt:Date.now(),content:e.value,replies:[],currentUser:x.currentUser,typeOfComment:"normal",replyingTo:""});q.appendChild(n);n.querySelector("#edit-btn").focus();const o=I.querySelector(".form__text"),r={id:t,content:e.value,createdAt:Date.now(),user:x.currentUser,replies:[],score:0};b({commentData:r,isReply:!1,index:""}),o.value=""}},S=e=>{const t=e.querySelector(".form__topFocusTrap"),n=e.querySelector(".form__bottomFocusTrap"),o=e.querySelector(".form__text"),r=e.querySelector(".normal");t.addEventListener("focus",(()=>r.focus())),n.addEventListener("focus",(()=>o.focus()))},B=e=>{const n=t(),o=e.target.parentElement.parentElement.parentElement.parentElement.parentElement.closest(".commentBox__container"),r=o.querySelector("#reply-btn"),c=!o.classList.contains("reply-comment"),s=o.querySelector(".commentBox__replyFormContainer"),a=o.querySelector(".commentBox__replyCommentsContainer"),l=o.parentElement;if(!s.childNodes.length){const e=g({textareaPlaceholder:"Write a reply...",btnText:"Reply",submitFunc:()=>i({addReplyTo:c?a:l}),cancelFunc:({formToRemove:e})=>{e.remove(),r.focus()},withCancel:!0});E({appendFormTo:s,formToAppend:e});const t=e.querySelector("#form-content");t.focus();const i=({addReplyTo:r})=>{var c;const s=null===(c=r.parentElement)||void 0===c?void 0:c.parentElement,a=o.querySelector(".commentBox__username");if(t.value){const o=h(),c=C({id:o,score:0,userImage:n.currentUser.image.png,username:n.currentUser.username,createdAt:Date.now(),content:t.value,replies:[],currentUser:n.currentUser,typeOfComment:"reply",replyingTo:a.textContent});r.appendChild(c);const l={id:o,content:t.value,createdAt:Date.now(),replyingTo:a.innerText,user:n.currentUser,score:0};b({commentData:l,isReply:!0,index:s.getAttribute("id")}),e.remove()}}}},C=({id:e,score:t,userImage:n,username:c,createdAt:s,content:a,replies:l,currentUser:i,typeOfComment:d,replyingTo:m})=>{var u;const p=document.createElement("div");p.classList.add("commentBox__container"),p.id=e,"reply"===d&&p.classList.add("reply-comment");const v=`\n    <div class="commentBox">\n      <div class="commentBox__rate">\n          <button class="commentBox__rateBtn" id="upvote-btn" aria-label="Upvote comment">\n            <img src="./images/icon-plus.svg" alt="" width='10' height='10'/>\n          </button>\n          <p class="commentBox__likes">${t}</p>\n          <button class="commentBox__rateBtn" id="downvote-btn" aria-label="Downvote comment">\n            <img src="./images/icon-minus.svg" alt="" width='10' height='3' />\n          </button>\n      </div>\n      <div class="commentBox__body">\n          <div class="commentBox__topBar">\n            <div class="commentBox__userDetails">\n                <img class="commentBox__profilePicture" src="${n}" alt="" width="35" height="35"/>\n                <div class='commentBox__usernameAndDate'>\n                  <p class="commentBox__usernameAndBadge"><span class='commentBox__username'>${c}</span> \n                    ${c===i.username?"<span class='commentBox__badge'>you</span>":""}\n                  </p>\n                  <p class="commentBox__commentDate">${(e=>{const t=(Date.now()-e)/864e5,n=24*t,o=60*n,r=t/7,c=t/30.4375,s=t/365;if(o<1)return"Just now";if(o>=1&&o<60){const e=Math.floor(o);return`${e} ${1===e?"minute":"minutes"} ago`}if(n>=1&&n<24){const e=Math.floor(n);return`${e} ${1===e?"hour":"hours"} ago`}if(t>=1&&t<7){const e=Math.floor(t);return`${e} ${1===e?"day":"days"} ago`}if(r>=1&&r<4){const e=Math.floor(r);return`${e} ${1===e?"week":"weeks"} ago`}if(c>=1&&c<12){const e=Math.floor(c);return`${e} ${1===e?"month":"months"} ago`}if(s>=1){const e=Math.floor(s);return`${e} ${1===e?"year":"years"} ago`}return""})(s)}</p>\n                </div>\n            </div>\n            <div class="commentBox__btns"></div>\n          </div>\n          <p class="commentBox__text">\n            ${"reply"===d?`<span class="commentBox__replyToUser">@${m} </span>`:""}<span id="comment-text"></span>\n          </p>\n      </div>\n    </div>\n    <div class="commentBox__replyFormContainer"></div>\n    <div class="commentBox__replyContainer">\n    <div class="commentBox__helperLine"></div>\n      <div class="commentBox__replyCommentsContainer"></div>\n    </div>\n    `;p.innerHTML=v;const y=p.querySelector(".commentBox__rate"),f=null==y?void 0:y.querySelector("#upvote-btn"),_=y.querySelector("#downvote-btn"),b=y.querySelector(".commentBox__likes"),h=null===(u=p.querySelector(".commentBox__username"))||void 0===u?void 0:u.textContent;i.scored.forEach((t=>{if(t.id===e){if("upvote"===t.scoreType)return void f.classList.add("btn-active");_.classList.add("btn-active")}})),h===i.username?(f.disabled=!0,_.disabled=!0):(f.addEventListener("click",(()=>{r({elementToChange:b,commentId:p.id,scoreType:"upvote",commentType:d,upvoteBtn:f,downvoteBtn:_}),o({scoreType:"upvote",commentId:p.id,isReply:"reply"===d})})),_.addEventListener("click",(()=>{r({elementToChange:b,commentId:p.id,scoreType:"downvote",commentType:d,upvoteBtn:f,downvoteBtn:_}),o({scoreType:"downvote",commentId:p.id,isReply:"reply"===d})})));const x=p.querySelector(".commentBox__btns");if(i.username===c?(x.appendChild(L({text:"Delete",withIcon:!0,btnStyle:"normal"})),x.appendChild(L({text:"Edit",withIcon:!0,btnStyle:"normal"}))):x.appendChild(L({text:"Reply",withIcon:!0,btnStyle:"normal"})),p.querySelector("#comment-text").textContent+=a,l.length){const e=p.querySelector(".commentBox__replyCommentsContainer");l.forEach((t=>{e.appendChild(C({id:t.id,score:t.score,userImage:t.user.image.png,username:t.user.username,createdAt:t.createdAt,content:t.content,replies:[],currentUser:i,typeOfComment:"reply",replyingTo:t.replyingTo}))}))}return p},L=({text:e,withIcon:t,btnStyle:n})=>{const o=document.createElement("button");return o.classList.add("commentBox__btn"),o.classList.add("fill"===n?"fill":"normal"),"Delete"===e&&o.classList.add("delete-btn"),o.title=e,o.id=`${e.toLowerCase()}-btn`,t?o.innerHTML=`\n    <img src="./images/icon-${e.toLowerCase()}.svg" alt="" width="15" height="15" />\n    <span>${e}</span>\n  `:o.innerText=e,"Reply"===e&&o.addEventListener("click",B),"Delete"===e&&o.addEventListener("click",m),"Edit"===e&&o.addEventListener("click",v),o};var w=function(e,t,n,o){return new(n||(n=Promise))((function(r,c){function s(e){try{l(o.next(e))}catch(e){c(e)}}function a(e){try{l(o.throw(e))}catch(e){c(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))};const q=document.querySelector(".container"),I=document.querySelector(".form__container"),U=()=>{const e=t();e&&(M(e.comments,e.currentUser),E({appendFormTo:I,formToAppend:g({textareaPlaceholder:"Write a comment...",btnText:"Send",submitFunc:T,cancelFunc:({formToRemove:e})=>e.remove(),withCancel:!1})}),(()=>{const e=document.createElement("footer");e.classList.add("footer"),e.innerHTML='\n      <p>Developed by <a href="https://github.com/p-alex" rel="noopener" target="_blank" title="My Github Profile">Alex Daniel</a>.</p>\n    ',document.body.appendChild(e)})())},M=(e,t)=>{e.forEach((e=>{q.appendChild(C({id:e.id,score:e.score,userImage:e.user.image.png,username:e.user.username,createdAt:e.createdAt,content:e.content,replies:e.replies,currentUser:t,typeOfComment:"normal",replyingTo:""}))}))},F=({message:e})=>{const t=document.createElement("p");t.innerText=e,q.appendChild(t)};w(void 0,void 0,void 0,(function*(){yield w(void 0,void 0,void 0,(function*(){try{if(null===localStorage.getItem("data")){const e=yield fetch("data.json"),t=yield e.json();localStorage.setItem("data",JSON.stringify(t))}}catch(e){console.error(e),F({message:e.message})}})),U()}))})();